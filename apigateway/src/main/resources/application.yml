# ===================================================================
# CONFIGURACIÓN BASE (Común para todos los perfiles)
# ===================================================================
server:
  port: 8088

# Lee la variable de entorno JWT_PUBLIC_KEY
jwt:
  public-key: ${JWT_PUBLIC_KEY}

spring:
  main:
    web-application-type: reactive

---
# ===================================================================
# PERFIL DE DOCKER (Para desarrollo local)
# ===================================================================
spring:
  config:
    activate:
      on-profile: "docker"
  cloud:
    gateway:
      routes:
        - id: guias_route_docker
          uri: http://guia-service:8080 # Nombre de contenedor Docker
          predicates:
            - Path=/api/v1/guias/**
          filters:
            - StripPrefix=3

        - id: auth-service-docker
          uri: http://login-creaciondeusuarios:8080 # Nombre de contenedor Docker
          predicates:
            - Path=/auth/**
          filters:
            - RewritePath=/auth/(?<segment>.*), /api/auth/$\{segment}

        - id: users-service-docker
          uri: http://login-creaciondeusuarios:8080 # Nombre de contenedor Docker
          predicates:
            - Path=/users/**
          filters:
            - RewritePath=/users/(?<segment>.*), /api/users/$\{segment}
        
        - id: guias_docs_docker
          uri: http://guia-service:8080
          predicates:
            - Path=/v3/api-docs/guias_route_docker
          filters:
            - RewritePath=/v3/api-docs/guias_route_docker, /v3/api-docs

springdoc:
  swagger-ui:
    urls:
      - name: Servicio de Guías (Docker)
        url: /v3/api-docs/guias_route_docker

---
# ===================================================================
# PERFIL DE PRODUCCIÓN (Para Render)
# ===================================================================
spring:
  config:
    activate:
      on-profile: "prod"
  cloud:
    gateway:
      routes:
        - id: guias_route_prod
          uri: ${GUIAS_SERVICE_URL} # Leído de Render
          predicates:
            - Path=/api/v1/guias/**
          filters:
            - StripPrefix=3

        - id: reservas_route_prod
          uri: ${RESERVAS_SERVICE_URL} # Leído de Render
          predicates:
            - Path=/api/v1/reservas/**
          filters:
            - StripPrefix=3

        - id: auth-service-prod
          uri: ${LOGIN_SERVICE_URL} # Leído de Render
          predicates:
            - Path=/auth/**
          filters:
            - RewritePath=/auth/(?<segment>.*), /api/auth/$\{segment}

        - id: users-service-prod
          uri: ${LOGIN_SERVICE_URL} # Leído de Render
          predicates:
            - Path=/users/**
          filters:
            - RewritePath=/users/(?<segment>.*), /api/users/$\{segment}
        
        - id: guias_docs_prod
          uri: ${GUIAS_SERVICE_URL} # Leído de Render
          predicates:
            - Path=/v3/api-docs/guias_route_prod
          filters:
            - RewritePath=/v3/api-docs/guias_route_prod, /v3/api-docs

# Configuración de Swagger para el perfil 'prod'
springdoc:
  swagger-ui:
    urls:
      - name: Servicio de Guías
        url: /v3/api-docs/guias_route_prod